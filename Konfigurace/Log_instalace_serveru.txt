pacman -Syu	# neproslo hned
pacman -Syu --ignore bash,filesystem
pacman -S bash
pacman -Su (filesystem; presunul jsem soubory v /sbin)

	NEPROSLO: pak to nebootuje.

pacman -Syu --ignore bash,filesystem
pacman -Syu --ignore bash,filesystem
systemctl enable sshd
reboot

-----

pacman -S postfix (misto toho se upgraduje pacman)
pacman -S postfix

(chybi libsasl2)

pacman -S libsasl
systemctl enable sshd

reboot

(ssh funguje)

(nakopceni souboru)

useradd prvak
mkdir ~prvak
chmod -R 755 ~prvak; chown prvak:prvak ~prvak -R

pacman -S mc vim htop mlocate

postfix: update myhostname, mydomain, myorigin, inet_interfaces, mydestination, home_mailbox, 
	(sendmail path), velky chunk na konci, master.cf port;

virtual; postmap virtual: porad tomu vadi libsasl2.so.2!!!

updatedb

pacman -Sy

pacman -Su postfix --ignore bash,filesystem

(reinstall postfix)

(nejde to :( )
pacman -Syu --ignore bash,filesystem

mv sbin old-sbin
pacman -S bash
pacman -Su filesystem

IT WORKS :)

============================================

systemctl enable postfix
pacman -S dovecot

systemctl enable dovecot

postmap virtual

(aliases)

postalias aliases

postmap virtual

systemctl start postfix dovecot (fail): open directory defer: permission denied
(otoceni instalace postfixu)

(presunuti pacsave zpatky - virtual, aliases)

systemctl start postfix: OK

systemctl enable syslog-ng

(chybi SSL certifikat - kopiruji vcetne klicu pro dovecot a postfix)

(copy dovecot config)

systemctl restart postfix dovecot

reboot

ssh OK.

(kopiruju vimrc, odstranuju pathogen referenci, syntastic referenci)

(chybi dovecot certifikat a je chyba v configu)

(OK, dovecot startuje)

(auth failed - /etc/pam.d/dovecot missing)

(restart dovecot)

(heslo pro prvaka)

OK :)

TODO: naucit zalohovat pravidelne vlastni etccka

(nakopiruju bashrc, bash_profile)

(instaluju ruby)

OK

nakopirovavam puvodni obsah http


ssh-copy-id prvak@rny.cz

TODO: zakazat cteni secrets ostatnim na serveru!

kopirovani obsahu homu - .ssh hlavne, bin (btckit); secrets; konfiguraky

presunuti ~/git

pacman -S ack

useradd b4f-crm; mkdir ~b4f-crm; chmod 755 -R ~b4f-crm; chown -R b4f-crm:b4f-crm ~b4f-crm

kopirovani .ssh v b4f-crm; kopirovani gitu CRMka

rny.cz: it works.

cp .btckit, .gnupg, Maildir (56M)

git: tata tam stejne nema pristup.

pacman -S subversion

cp conf.d/svnserve (nic - je to stejne...)

systemctl enable svnserve; systemctl start svnserve

gem install passenger

pacman -S htop git mariadb

useradd rails, mkdir /srv/rails/...

allow key

mysql_secure_installation

TODO: mysql zalohovani

systemctl start mysqld; systemctl enable mysqld

pacman -S strace

==============

VVV ??????

MegaCli
lsiutil
mpt-status
tw_cli

=====

pokus o apache

pacman -S apache
passenge-install-apache2-module

systemctl enable httpd

pacman -S v8 nodejs sudo

Vytvoril jsem v ~/backup/skripty/backup-mysql na tohle Ruby skript.
Pridam uzivatele pro mysql:

	GRANT LOCK TABLES, SELECT ON *.* TO backup@localhost IDENTIFIED BY ...;

pacman -S python2-pyinotify fail2ban
aktivace (provedu to i na rincewindu); startovani

zalozeni uzivatele pp, symlink do ordinace, pridani prav zapisu

groupadd ordinace
gpasswd -a rails ordinace
gpasswd -a pp ordinace

chgrp -R ordinace /srv/rails/ordinace
chmod -R g+rwx /srv/rails/ordinace

create group ordinace

motd, hostname "dragon"

LAMP: 
	pacman -S php php-apache

	ServerSignature Off
	ServerTokens Prod

	LoadModule php5_module modules/libphp5.so

	Include conf/extra/php5_module.conf
	uncomment MIMEMagicFile conf/magic

	pridat do mime.types: application/x-httpd-php php php5

	(test.php - phpinfo: funguje to)

php.ini:
	date.timezone = Europe/Prague

	extension=exif.so
	extension=ftp.so
	extension=gd.so
	extension=iconv.so
	extension=mcrypt.so
	extension=mysqli.so
	extension=mysql.so
	extension=openssl.so
	extension=pdo_mysql.so
	extension=soap.so
	extension=xmlrpc.so
	extension=xsl.so
	extension=zip.so

	pacman -S php-mcrypt php-sqlite php-gd

Virtualni host work.

	PassengerPreStart http://orldecin.cz
	PassengerPreStart http://kolej.anek.cz

my.cnf:
	uncomment skip-networking

pacman -S vsftpd
systemctl enable vsftpd
systemctl start vsftpd

/etc/vsftpd: anonymous_enable=NO
	local_enable=YES
	write_enable=YES
	local_umask=022
	

chown -R prvak:http work
chmod -R 770 work

(vytvoreni ios-medical databaze a uzivatele)
	create database ios_medical_db;
	grant all privileges on ios_medical_db.* to ios_medical identified by "M3Dical_271";

/etc/ssh/sshd_config: zmena LogLevel INFO na LogLevel VERBOSE aby fungoval fail2ban

fail2ban: vsftpd-iptables - zapnout, konf. mailu
	ssh-iptables - zapnout, konf. mailu

iptables aby fungovalo fail2ban:
	
	(pacman -S iptables)

	systemctl enable iptables
	systemctl start iptables 

	cp /etc/iptables/empty.rules /etc/iptables/iptables.rules (aby to slo zapnout)
	systemctl start iptables
	
systemctl restart fail2ban

vhost pp

symlink v ~pp na pp.rny.cz

(presun srv do /home/srv)
(ln -s /home/srv /srv)

(prepnuti fail2ban tak, aby se to koukalo spravne do /var/log/auth.log)

Je potreba mit hodinovy cron na wget http://rezervace.cardiofitnessdc.cz/?presenter=Cron -O/dev/null -o/dev/null > /dev/null.
	(Je to nejaky historicky duvod. Neslo to nastavit na cardiofitnessdc serveru...)

pacman -S uptimed
systemctl enable uptimed; systemctl start uptimed

postfix virtual: "pok@rny.cz prvak@localhost" aby slo posilat maily primo z dragonu (??)

barvicky v /etc/bash.bashrc

pacman -S colordiff

apache: vhost rny.cz dany jako default, pridan vhost podnikani.rny.cz (url rewrite na http://podnikani.tchk.cz)

systemctl enable ntpd

pridan vhost psmf.rny.cz co servuje "404"

orldecin.cz:
	ServerName orldecin.cz
	ServerAlias www.orldecin.cz orldecin.cz
